<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>sub window</title>
  </head>
  <body>
    <div class="container">
      <p>起動画面</p>
      <p>window名: <span id="window-name"></span></p>
      <p>
        <button id="window-open">window.open</button>
      </p>
      <p>Cookie: <span id="cookie"></p>
    </div>

    <script>
      var cookieKey = "sub_window";
      var windowName = window.location.href.match(new RegExp("[?&]window=(.*?)(&|$|#)"))[1];

      function getCookie(key) {
        return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)" + key + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1");
      }

      function addCookie(key, value) {
        var values = getCookie(key);
        if (values === "") {
          values = [value];
        } else {
          var values = values.split(",");
          values.push(value);
        }
        document.cookie = key + "=" + values.join(",")
      }

      function removeCookie(key, value) {
        var cookie = getCookie(key).split(",");
        cookie = cookie.filter(function(val) { return val != value });
        document.cookie = key + "=" + cookie.join(",");
      }

      function isOpened(windowName) {
        return getCookie(cookieKey).split(",").indexOf(windowName) >= 0;
      }

      function openSubWindow(target, name) {
        addCookie(cookieKey, name);
        window.open(target, name);
      }

      document.querySelector("#window-open").addEventListener("click", () => {
        if (!isOpened(windowName)) {
          openSubWindow("subsub.html", windowName);
        }
        window.close();
      });


      document.querySelector("#window-name").textContent = windowName;
      document.querySelector("#cookie").textContent = document.cookie;
    </script>
  </body>
</html>
